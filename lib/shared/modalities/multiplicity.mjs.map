{"version":3,"sources":["../../../src/shared/modalities/multiplicity.ts"],"sourcesContent":["import { Semiring } from \"fp-ts/lib/Semiring\";\nimport { match, P } from \"ts-pattern\";\nimport _ from \"lodash\";\n\nconst MULTIPLICITY = {\n\tZero: \"Zero\",\n\tOne: \"One\",\n\tMany: \"Many\",\n} as const;\nexport const { Zero, One, Many } = MULTIPLICITY;\nexport type Multiplicity = (typeof MULTIPLICITY)[keyof typeof MULTIPLICITY];\nexport type Usages = Multiplicity[];\n\nexport const SR: Semiring<Multiplicity> = {\n\tzero: \"Zero\",\n\tone: \"One\",\n\tadd(x, y) {\n\t\treturn match([x, y])\n\t\t\t.with([\"Many\", P._], [P._, \"Many\"], (): Multiplicity => \"Many\")\n\t\t\t.with([\"One\", \"One\"], (): Multiplicity => \"Many\")\n\t\t\t.with([\"One\", P._], [P._, \"One\"], (): Multiplicity => \"One\")\n\t\t\t.otherwise(() => \"Zero\");\n\t},\n\tmul(x, y) {\n\t\treturn match([x, y])\n\t\t\t.with([\"Zero\", P._], [P._, \"Zero\"], (): Multiplicity => \"Zero\")\n\t\t\t.with([\"One\", P._], ([, m]) => m)\n\t\t\t.with([P._, \"One\"], ([m]) => m)\n\t\t\t.otherwise(() => \"One\");\n\t},\n};\n\nexport const noUsage = (lvl: number): Multiplicity[] => Array(lvl).fill(\"Zero\");\n\nexport const multiply = (q: Multiplicity, usages: Usages) => usages.map(u => SR.mul(q, u));\nexport const add = (u1: Usages, u2: Usages) => {\n\t// if (u1.length !== u2.length) throw new Error(\"Mismatched usage lengths\")\n\n\treturn _.zipWith(u1, u2, (a = \"Zero\", b = \"Zero\") => SR.add(a, b));\n};\n\nexport const display = (multiplicity: Multiplicity): string => {\n\treturn match(multiplicity)\n\t\t.with(\"One\", () => \"1\")\n\t\t.with(\"Zero\", () => \"0\")\n\t\t.with(\"Many\", () => \"Ï‰\")\n\t\t.otherwise(() => JSON.stringify(multiplicity));\n};\n"],"mappings":";AACA,SAAS,OAAO,SAAS;AACzB,OAAO,OAAO;AAEd,MAAM,eAAe;AAAA,EACpB,MAAM;AAAA,EACN,KAAK;AAAA,EACL,MAAM;AACP;AACO,MAAM,EAAE,MAAM,KAAK,KAAK,IAAI;AAI5B,MAAM,KAA6B;AAAA,EACzC,MAAM;AAAA,EACN,KAAK;AAAA,EACL,IAAI,GAAG,GAAG;AACT,WAAO,MAAM,CAAC,GAAG,CAAC,CAAC,EACjB,KAAK,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,MAAM,GAAG,MAAoB,MAAM,EAC7D,KAAK,CAAC,OAAO,KAAK,GAAG,MAAoB,MAAM,EAC/C,KAAK,CAAC,OAAO,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,KAAK,GAAG,MAAoB,KAAK,EAC1D,UAAU,MAAM,MAAM;AAAA,EACzB;AAAA,EACA,IAAI,GAAG,GAAG;AACT,WAAO,MAAM,CAAC,GAAG,CAAC,CAAC,EACjB,KAAK,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,MAAM,GAAG,MAAoB,MAAM,EAC7D,KAAK,CAAC,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,EAC/B,KAAK,CAAC,EAAE,GAAG,KAAK,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,EAC7B,UAAU,MAAM,KAAK;AAAA,EACxB;AACD;AAEO,MAAM,UAAU,CAAC,QAAgC,MAAM,GAAG,EAAE,KAAK,MAAM;AAEvE,MAAM,WAAW,CAAC,GAAiB,WAAmB,OAAO,IAAI,OAAK,GAAG,IAAI,GAAG,CAAC,CAAC;AAClF,MAAM,MAAM,CAAC,IAAY,OAAe;AAG9C,SAAO,EAAE,QAAQ,IAAI,IAAI,CAAC,IAAI,QAAQ,IAAI,WAAW,GAAG,IAAI,GAAG,CAAC,CAAC;AAClE;AAEO,MAAM,UAAU,CAAC,iBAAuC;AAC9D,SAAO,MAAM,YAAY,EACvB,KAAK,OAAO,MAAM,GAAG,EACrB,KAAK,QAAQ,MAAM,GAAG,EACtB,KAAK,QAAQ,MAAM,QAAG,EACtB,UAAU,MAAM,KAAK,UAAU,YAAY,CAAC;AAC/C;","names":[]}