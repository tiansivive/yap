{"version":3,"sources":["../../src/shared/logging.ts"],"sourcesContent":["import fs from \"fs\";\nimport winston from \"winston\";\n\nexport const logFilePath = \".logs/elaboration.json.log\";\n\nexport const mkLogger = (filepath: string = logFilePath, opts = { start: \"\", end: \"\" }) => {\n\treturn {\n\t\topen: (start = opts.start) => fs.writeFileSync(filepath, start),\n\t\tlog: (phase: \"entry\" | \"exit\", key: string, obj: {}) => {\n\t\t\tconst json = JSON.stringify(obj);\n\n\t\t\tconst msg = phase === \"entry\" ? `\\n\"${key}\": ${json.substring(0, json.length - 1)},` : `\\n\"${key}\": ${json} },`;\n\t\t\tfs.appendFileSync(filepath, msg);\n\t\t},\n\t\tclose: (end = opts.end) => fs.appendFileSync(filepath, end),\n\t};\n};\n\nconst label = [\"Lama\"];\n\nexport const push = (l: string) => label.push(l);\nexport const pop = () => label.pop();\nexport const peek = () => label[label.length - 1];\n\nexport const logger = winston.createLogger({\n\ttransports: [\n\t\tnew winston.transports.File({\n\t\t\tfilename: \".logs/debug.log\",\n\t\t\tlevel: \"debug\",\n\t\t\tformat: winston.format.combine(\n\t\t\t\twinston.format(info => {\n\t\t\t\t\tconst msg = `[${label.join(\".\")}] ${info.message}`;\n\t\t\t\t\tinfo[Symbol.for(\"message\")] = msg.replace(/\\n/g, \" \");\n\n\t\t\t\t\tconst meta = Object.entries(info).reduce((acc: object, [key, value]) => {\n\t\t\t\t\t\tif (typeof key !== \"symbol\" && key !== \"message\" && key !== \"level\") {\n\t\t\t\t\t\t\treturn { ...acc, [key]: value };\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t}, {});\n\t\t\t\t\tinfo.metadata = meta;\n\t\t\t\t\treturn info;\n\t\t\t\t})(),\n\t\t\t\twinston.format.metadata(),\n\t\t\t),\n\t\t}),\n\t],\n});\n\nconst fmt = winston.format.label({ label: label.join(\".\") });\n"],"mappings":";AAAA,OAAO,QAAQ;AACf,OAAO,aAAa;AAEb,MAAM,cAAc;AAEpB,MAAM,WAAW,CAAC,WAAmB,aAAa,OAAO,EAAE,OAAO,IAAI,KAAK,GAAG,MAAM;AAC1F,SAAO;AAAA,IACN,MAAM,CAAC,QAAQ,KAAK,UAAU,GAAG,cAAc,UAAU,KAAK;AAAA,IAC9D,KAAK,CAAC,OAAyB,KAAa,QAAY;AACvD,YAAM,OAAO,KAAK,UAAU,GAAG;AAE/B,YAAM,MAAM,UAAU,UAAU;AAAA,GAAM,GAAG,MAAM,KAAK,UAAU,GAAG,KAAK,SAAS,CAAC,CAAC,MAAM;AAAA,GAAM,GAAG,MAAM,IAAI;AAC1G,SAAG,eAAe,UAAU,GAAG;AAAA,IAChC;AAAA,IACA,OAAO,CAAC,MAAM,KAAK,QAAQ,GAAG,eAAe,UAAU,GAAG;AAAA,EAC3D;AACD;AAEA,MAAM,QAAQ,CAAC,MAAM;AAEd,MAAM,OAAO,CAAC,MAAc,MAAM,KAAK,CAAC;AACxC,MAAM,MAAM,MAAM,MAAM,IAAI;AAC5B,MAAM,OAAO,MAAM,MAAM,MAAM,SAAS,CAAC;AAEzC,MAAM,SAAS,QAAQ,aAAa;AAAA,EAC1C,YAAY;AAAA,IACX,IAAI,QAAQ,WAAW,KAAK;AAAA,MAC3B,UAAU;AAAA,MACV,OAAO;AAAA,MACP,QAAQ,QAAQ,OAAO;AAAA,QACtB,QAAQ,OAAO,UAAQ;AACtB,gBAAM,MAAM,IAAI,MAAM,KAAK,GAAG,CAAC,KAAK,KAAK,OAAO;AAChD,eAAK,OAAO,IAAI,SAAS,CAAC,IAAI,IAAI,QAAQ,OAAO,GAAG;AAEpD,gBAAM,OAAO,OAAO,QAAQ,IAAI,EAAE,OAAO,CAAC,KAAa,CAAC,KAAK,KAAK,MAAM;AACvE,gBAAI,OAAO,QAAQ,YAAY,QAAQ,aAAa,QAAQ,SAAS;AACpE,qBAAO,EAAE,GAAG,KAAK,CAAC,GAAG,GAAG,MAAM;AAAA,YAC/B;AACA,mBAAO;AAAA,UACR,GAAG,CAAC,CAAC;AACL,eAAK,WAAW;AAChB,iBAAO;AAAA,QACR,CAAC,EAAE;AAAA,QACH,QAAQ,OAAO,SAAS;AAAA,MACzB;AAAA,IACD,CAAC;AAAA,EACF;AACD,CAAC;AAED,MAAM,MAAM,QAAQ,OAAO,MAAM,EAAE,OAAO,MAAM,KAAK,GAAG,EAAE,CAAC;","names":[]}