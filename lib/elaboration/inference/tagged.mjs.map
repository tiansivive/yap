{"version":3,"sources":["../../../src/elaboration/inference/tagged.ts"],"sourcesContent":["import * as F from \"fp-ts/function\";\n\nimport * as EB from \"@yap/elaboration\";\nimport * as V2 from \"@yap/elaboration/shared/monad.v2\";\n\nimport * as NF from \"@yap/elaboration/normalization\";\nimport * as Src from \"@yap/src/index\";\n\nimport * as R from \"@yap/shared/rows\";\n\ntype Tagged = Extract<Src.Term, { type: \"tagged\" }>;\n\nexport const infer = (tagged: Tagged): V2.Elaboration<EB.AST> =>\n\tV2.track(\n\t\t{ tag: \"src\", type: \"term\", term: tagged, metadata: { action: \"infer\", description: \"Tagged\" } },\n\t\tV2.Do(function* () {\n\t\t\tconst { tag, term } = tagged;\n\n\t\t\tconst [tm, ty, us] = yield* EB.infer.gen(term);\n\t\t\tconst ctx = yield* V2.ask();\n\t\t\tconst rvar: NF.Row = R.Constructors.Variable(yield* EB.freshMeta(ctx.env.length, NF.Row));\n\t\t\tconst row: NF.Row = NF.Constructors.Extension(tag, ty, rvar);\n\t\t\tconst variant = NF.Constructors.Variant(row);\n\n\t\t\tconst trow = EB.Constructors.Extension(tag, tm, { type: \"empty\" });\n\t\t\tconst tagtm = EB.Constructors.Struct(trow);\n\t\t\treturn [tagtm, variant, us] satisfies EB.AST;\n\t\t}),\n\t);\ninfer.gen = F.flow(infer, V2.pure);\n"],"mappings":";AAAA,YAAY,OAAO;AAEnB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AAEpB,YAAY,QAAQ;AAGpB,YAAY,OAAO;AAIZ,MAAM,QAAQ,CAAC,WACrB,GAAG;AAAA,EACF,EAAE,KAAK,OAAO,MAAM,QAAQ,MAAM,QAAQ,UAAU,EAAE,QAAQ,SAAS,aAAa,SAAS,EAAE;AAAA,EAC/F,GAAG,GAAG,aAAa;AAClB,UAAM,EAAE,KAAK,KAAK,IAAI;AAEtB,UAAM,CAAC,IAAI,IAAI,EAAE,IAAI,OAAO,GAAG,MAAM,IAAI,IAAI;AAC7C,UAAM,MAAM,OAAO,GAAG,IAAI;AAC1B,UAAM,OAAe,EAAE,aAAa,SAAS,OAAO,GAAG,UAAU,IAAI,IAAI,QAAQ,GAAG,GAAG,CAAC;AACxF,UAAM,MAAc,GAAG,aAAa,UAAU,KAAK,IAAI,IAAI;AAC3D,UAAM,UAAU,GAAG,aAAa,QAAQ,GAAG;AAE3C,UAAM,OAAO,GAAG,aAAa,UAAU,KAAK,IAAI,EAAE,MAAM,QAAQ,CAAC;AACjE,UAAM,QAAQ,GAAG,aAAa,OAAO,IAAI;AACzC,WAAO,CAAC,OAAO,SAAS,EAAE;AAAA,EAC3B,CAAC;AACF;AACD,MAAM,MAAM,EAAE,KAAK,OAAO,GAAG,IAAI;","names":[]}