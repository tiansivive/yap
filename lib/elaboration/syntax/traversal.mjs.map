{"version":3,"sources":["../../../src/elaboration/syntax/traversal.ts"],"sourcesContent":["import { match } from \"ts-pattern\";\nimport { update } from \"@yap/utils\";\n\nimport * as F from \"fp-ts/lib/function\";\n\nimport * as R from \"@yap/shared/rows\";\nimport { Constructors, CtorPatterns, Term } from \"./term\";\n\nexport const traverse = (tm: Term, onVar: (v: Extract<Term, { type: \"Var\" }>) => Term): Term => {\n\treturn (\n\t\tmatch(tm)\n\t\t\t.with({ type: \"Var\" }, onVar)\n\t\t\t.with({ type: \"Lit\" }, lit => lit)\n\t\t\t.with(CtorPatterns.Lambda, ({ binding, body }) => Constructors.Abs(binding, traverse(body, onVar)))\n\t\t\t.with(CtorPatterns.Pi, ({ binding, body }) =>\n\t\t\t\tConstructors.Abs(\n\t\t\t\t\tupdate(binding, \"annotation\", tm => tm), // QUESTION: traverse type?\n\t\t\t\t\ttraverse(body, onVar),\n\t\t\t\t),\n\t\t\t)\n\t\t\t.with(CtorPatterns.Mu, ({ binding, body }) =>\n\t\t\t\tConstructors.Abs(\n\t\t\t\t\tupdate(binding, \"annotation\", tm => tm), // QUESTION: traverse type?\n\t\t\t\t\ttraverse(body, onVar),\n\t\t\t\t),\n\t\t\t)\n\t\t\t.with({ type: \"App\" }, ({ icit, func, arg }) => Constructors.App(icit, traverse(func, onVar), traverse(arg, onVar)))\n\t\t\t.with({ type: \"Row\" }, ({ row }) =>\n\t\t\t\tConstructors.Row(\n\t\t\t\t\tR.traverse(\n\t\t\t\t\t\trow,\n\t\t\t\t\t\tv => traverse(v, onVar),\n\t\t\t\t\t\tv => R.Constructors.Variable(v),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t)\n\t\t\t.with({ type: \"Proj\" }, ({ label, term }) => Constructors.Proj(label, traverse(term, onVar)))\n\t\t\t.with({ type: \"Inj\" }, ({ label, value, term }) => Constructors.Inj(label, traverse(value, onVar), traverse(term, onVar)))\n\t\t\t//.with({ type: \"Annotation\" }, ({ term, ann }) => Constructors.Annotation(traverse(term, onVar), traverse(ann, onVar)))\n\t\t\t.with({ type: \"Match\" }, ({ scrutinee, alternatives }) =>\n\t\t\t\tConstructors.Match(\n\t\t\t\t\ttraverse(scrutinee, onVar),\n\t\t\t\t\talternatives.map(({ pattern, term, binders }) => ({ pattern, term: traverse(term, onVar), binders })),\n\t\t\t\t),\n\t\t\t)\n\t\t\t.with({ type: \"Block\" }, ({ return: ret, statements }) => {\n\t\t\t\tconst stmts = statements.map(s =>\n\t\t\t\t\tmatch(s)\n\t\t\t\t\t\t.with({ type: \"Let\" }, letdec =>\n\t\t\t\t\t\t\tF.pipe(\n\t\t\t\t\t\t\t\tletdec,\n\t\t\t\t\t\t\t\tupdate(\"value\", v => traverse(v, onVar)),\n\t\t\t\t\t\t\t\tupdate(\"annotation\", ann => ann), // QUESTION: traverse type?\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.otherwise(update(\"value\", v => traverse(v, onVar))),\n\t\t\t\t);\n\t\t\t\treturn Constructors.Block(stmts, traverse(ret, onVar));\n\t\t\t})\n\t\t\t.with({ type: \"Modal\" }, ({ term, modalities }) => Constructors.Modal(traverse(term, onVar), modalities))\n\t\t\t.otherwise(() => {\n\t\t\t\tthrow new Error(\"Traverse: Not implemented yet\");\n\t\t\t})\n\t);\n};\n"],"mappings":";AAAA,SAAS,aAAa;AACtB,SAAS,cAAc;AAEvB,YAAY,OAAO;AAEnB,YAAY,OAAO;AACnB,SAAS,cAAc,oBAA0B;AAE1C,MAAM,WAAW,CAAC,IAAU,UAA6D;AAC/F,SACC,MAAM,EAAE,EACN,KAAK,EAAE,MAAM,MAAM,GAAG,KAAK,EAC3B,KAAK,EAAE,MAAM,MAAM,GAAG,SAAO,GAAG,EAChC,KAAK,aAAa,QAAQ,CAAC,EAAE,SAAS,KAAK,MAAM,aAAa,IAAI,SAAS,SAAS,MAAM,KAAK,CAAC,CAAC,EACjG;AAAA,IAAK,aAAa;AAAA,IAAI,CAAC,EAAE,SAAS,KAAK,MACvC,aAAa;AAAA,MACZ,OAAO,SAAS,cAAc,CAAAA,QAAMA,GAAE;AAAA;AAAA,MACtC,SAAS,MAAM,KAAK;AAAA,IACrB;AAAA,EACD,EACC;AAAA,IAAK,aAAa;AAAA,IAAI,CAAC,EAAE,SAAS,KAAK,MACvC,aAAa;AAAA,MACZ,OAAO,SAAS,cAAc,CAAAA,QAAMA,GAAE;AAAA;AAAA,MACtC,SAAS,MAAM,KAAK;AAAA,IACrB;AAAA,EACD,EACC,KAAK,EAAE,MAAM,MAAM,GAAG,CAAC,EAAE,MAAM,MAAM,IAAI,MAAM,aAAa,IAAI,MAAM,SAAS,MAAM,KAAK,GAAG,SAAS,KAAK,KAAK,CAAC,CAAC,EAClH;AAAA,IAAK,EAAE,MAAM,MAAM;AAAA,IAAG,CAAC,EAAE,IAAI,MAC7B,aAAa;AAAA,MACZ,EAAE;AAAA,QACD;AAAA,QACA,OAAK,SAAS,GAAG,KAAK;AAAA,QACtB,OAAK,EAAE,aAAa,SAAS,CAAC;AAAA,MAC/B;AAAA,IACD;AAAA,EACD,EACC,KAAK,EAAE,MAAM,OAAO,GAAG,CAAC,EAAE,OAAO,KAAK,MAAM,aAAa,KAAK,OAAO,SAAS,MAAM,KAAK,CAAC,CAAC,EAC3F,KAAK,EAAE,MAAM,MAAM,GAAG,CAAC,EAAE,OAAO,OAAO,KAAK,MAAM,aAAa,IAAI,OAAO,SAAS,OAAO,KAAK,GAAG,SAAS,MAAM,KAAK,CAAC,CAAC,EAExH;AAAA,IAAK,EAAE,MAAM,QAAQ;AAAA,IAAG,CAAC,EAAE,WAAW,aAAa,MACnD,aAAa;AAAA,MACZ,SAAS,WAAW,KAAK;AAAA,MACzB,aAAa,IAAI,CAAC,EAAE,SAAS,MAAM,QAAQ,OAAO,EAAE,SAAS,MAAM,SAAS,MAAM,KAAK,GAAG,QAAQ,EAAE;AAAA,IACrG;AAAA,EACD,EACC,KAAK,EAAE,MAAM,QAAQ,GAAG,CAAC,EAAE,QAAQ,KAAK,WAAW,MAAM;AACzD,UAAM,QAAQ,WAAW;AAAA,MAAI,OAC5B,MAAM,CAAC,EACL;AAAA,QAAK,EAAE,MAAM,MAAM;AAAA,QAAG,YACtB,EAAE;AAAA,UACD;AAAA,UACA,OAAO,SAAS,OAAK,SAAS,GAAG,KAAK,CAAC;AAAA,UACvC,OAAO,cAAc,SAAO,GAAG;AAAA;AAAA,QAChC;AAAA,MACD,EACC,UAAU,OAAO,SAAS,OAAK,SAAS,GAAG,KAAK,CAAC,CAAC;AAAA,IACrD;AACA,WAAO,aAAa,MAAM,OAAO,SAAS,KAAK,KAAK,CAAC;AAAA,EACtD,CAAC,EACA,KAAK,EAAE,MAAM,QAAQ,GAAG,CAAC,EAAE,MAAM,WAAW,MAAM,aAAa,MAAM,SAAS,MAAM,KAAK,GAAG,UAAU,CAAC,EACvG,UAAU,MAAM;AAChB,UAAM,IAAI,MAAM,+BAA+B;AAAA,EAChD,CAAC;AAEJ;","names":["tm"]}