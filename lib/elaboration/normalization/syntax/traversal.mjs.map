{"version":3,"sources":["../../../../src/elaboration/normalization/syntax/traversal.ts"],"sourcesContent":["import * as EB from \"@yap/elaboration\";\nimport * as R from \"@yap/shared/rows\";\n\nimport { Value, Constructors, Patterns } from \"./term\";\nimport { match } from \"ts-pattern\";\n\nimport { update } from \"@yap/utils\";\n\nexport const traverse = (nf: Value, onVar: (v: Extract<Value, { type: \"Var\" }>) => Value, onTerm: (tm: EB.Term) => EB.Term): Value => {\n\treturn match(nf)\n\t\t.with({ type: \"Var\" }, onVar)\n\t\t.with({ type: \"Lit\" }, lit => lit)\n\t\t.with(Patterns.Lambda, ({ binder, closure }) =>\n\t\t\tConstructors.Lambda(binder.variable, binder.icit, update(closure, \"term\", onTerm), traverse(binder.annotation, onVar, onTerm)),\n\t\t)\n\t\t.with(Patterns.Pi, ({ binder, closure }) => {\n\t\t\tconst { annotation } = binder;\n\t\t\treturn Constructors.Pi(binder.variable, binder.icit, traverse(annotation, onVar, onTerm), update(closure, \"term\", onTerm));\n\t\t})\n\t\t.with(Patterns.Mu, ({ binder, closure }) => {\n\t\t\tconst { annotation } = binder;\n\t\t\treturn Constructors.Mu(binder.variable, binder.source, traverse(annotation, onVar, onTerm), update(closure, \"term\", onTerm));\n\t\t})\n\t\t.with({ type: \"App\" }, ({ icit, func, arg }) => Constructors.App(traverse(func, onVar, onTerm), traverse(arg, onVar, onTerm), icit))\n\t\t.with({ type: \"Row\" }, ({ row }) =>\n\t\t\tConstructors.Row(\n\t\t\t\tR.traverse(\n\t\t\t\t\trow,\n\t\t\t\t\tv => traverse(v, onVar, onTerm),\n\t\t\t\t\tv => R.Constructors.Variable(v),\n\t\t\t\t),\n\t\t\t),\n\t\t)\n\t\t.with({ type: \"Neutral\" }, ({ value }) => Constructors.Neutral(traverse(value, onVar, onTerm)))\n\t\t.with(Patterns.Modal, ({ value, modalities }) =>\n\t\t\tConstructors.Modal(traverse(value, onVar, onTerm), {\n\t\t\t\tquantity: modalities.quantity,\n\t\t\t\tliquid: traverse(modalities.liquid, onVar, onTerm),\n\t\t\t}),\n\t\t)\n\t\t.otherwise(() => {\n\t\t\tthrow new Error(\"Traverse: Not implemented yet\");\n\t\t});\n};\n"],"mappings":";AACA,YAAY,OAAO;AAEnB,SAAgB,cAAc,gBAAgB;AAC9C,SAAS,aAAa;AAEtB,SAAS,cAAc;AAEhB,MAAM,WAAW,CAAC,IAAW,OAAsD,WAA4C;AACrI,SAAO,MAAM,EAAE,EACb,KAAK,EAAE,MAAM,MAAM,GAAG,KAAK,EAC3B,KAAK,EAAE,MAAM,MAAM,GAAG,SAAO,GAAG,EAChC;AAAA,IAAK,SAAS;AAAA,IAAQ,CAAC,EAAE,QAAQ,QAAQ,MACzC,aAAa,OAAO,OAAO,UAAU,OAAO,MAAM,OAAO,SAAS,QAAQ,MAAM,GAAG,SAAS,OAAO,YAAY,OAAO,MAAM,CAAC;AAAA,EAC9H,EACC,KAAK,SAAS,IAAI,CAAC,EAAE,QAAQ,QAAQ,MAAM;AAC3C,UAAM,EAAE,WAAW,IAAI;AACvB,WAAO,aAAa,GAAG,OAAO,UAAU,OAAO,MAAM,SAAS,YAAY,OAAO,MAAM,GAAG,OAAO,SAAS,QAAQ,MAAM,CAAC;AAAA,EAC1H,CAAC,EACA,KAAK,SAAS,IAAI,CAAC,EAAE,QAAQ,QAAQ,MAAM;AAC3C,UAAM,EAAE,WAAW,IAAI;AACvB,WAAO,aAAa,GAAG,OAAO,UAAU,OAAO,QAAQ,SAAS,YAAY,OAAO,MAAM,GAAG,OAAO,SAAS,QAAQ,MAAM,CAAC;AAAA,EAC5H,CAAC,EACA,KAAK,EAAE,MAAM,MAAM,GAAG,CAAC,EAAE,MAAM,MAAM,IAAI,MAAM,aAAa,IAAI,SAAS,MAAM,OAAO,MAAM,GAAG,SAAS,KAAK,OAAO,MAAM,GAAG,IAAI,CAAC,EAClI;AAAA,IAAK,EAAE,MAAM,MAAM;AAAA,IAAG,CAAC,EAAE,IAAI,MAC7B,aAAa;AAAA,MACZ,EAAE;AAAA,QACD;AAAA,QACA,OAAK,SAAS,GAAG,OAAO,MAAM;AAAA,QAC9B,OAAK,EAAE,aAAa,SAAS,CAAC;AAAA,MAC/B;AAAA,IACD;AAAA,EACD,EACC,KAAK,EAAE,MAAM,UAAU,GAAG,CAAC,EAAE,MAAM,MAAM,aAAa,QAAQ,SAAS,OAAO,OAAO,MAAM,CAAC,CAAC,EAC7F;AAAA,IAAK,SAAS;AAAA,IAAO,CAAC,EAAE,OAAO,WAAW,MAC1C,aAAa,MAAM,SAAS,OAAO,OAAO,MAAM,GAAG;AAAA,MAClD,UAAU,WAAW;AAAA,MACrB,QAAQ,SAAS,WAAW,QAAQ,OAAO,MAAM;AAAA,IAClD,CAAC;AAAA,EACF,EACC,UAAU,MAAM;AAChB,UAAM,IAAI,MAAM,+BAA+B;AAAA,EAChD,CAAC;AACH;","names":[]}