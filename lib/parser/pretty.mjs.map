{"version":3,"sources":["../../src/parser/pretty.ts"],"sourcesContent":["import { match } from \"ts-pattern\";\n\nimport * as Lit from \"@yap/shared/literals\";\nimport * as Icit from \"@yap/shared/implicitness\";\n\nimport * as Src from \"@yap/src/index\";\nimport * as R from \"@yap/shared/rows\";\n\nimport * as Q from \"@yap/shared/modalities/multiplicity\";\n\nexport const display = (term: Src.Term): string => {\n\treturn match(term)\n\t\t.with({ type: \"lit\" }, ({ value }) => Lit.display(value))\n\t\t.with({ type: \"var\" }, ({ variable }) => variable.value)\n\t\t.with({ type: \"hole\" }, _ => \"?\")\n\t\t.with({ type: \"arrow\" }, ({ lhs, rhs, icit }) => {\n\t\t\treturn `${Icit.display(icit)}${display(lhs)} ${arr(icit)} ${display(rhs)}`;\n\t\t})\n\t\t.with({ type: \"lambda\" }, ({ icit, variable, annotation, body }) => {\n\t\t\tconst ann = annotation ? `: ${display(annotation)}` : \"\";\n\t\t\treturn `λ(${variable}${ann}) ${arr(icit)} ${display(body)}`;\n\t\t})\n\t\t.with({ type: \"pi\" }, ({ icit, variable, annotation, body }) => {\n\t\t\treturn `Π(${variable}: ${display(annotation)}) ${arr(icit)} ${display(body)}`;\n\t\t})\n\t\t.with({ type: \"application\" }, ({ icit, fn, arg }) => {\n\t\t\tconst f = display(fn);\n\t\t\tconst a = display(arg);\n\n\t\t\tconst wrappedFn = fn.type !== \"var\" && fn.type !== \"lit\" && fn.type !== \"application\" ? `(${f})` : f;\n\t\t\tconst wrappedArg =\n\t\t\t\targ.type === \"lambda\" || arg.type === \"pi\" || arg.type === \"arrow\" || arg.type === \"annotation\" || arg.type === \"application\" || arg.type === \"match\"\n\t\t\t\t\t? `(${a})`\n\t\t\t\t\t: a;\n\n\t\t\treturn `${wrappedFn} ${Icit.display(icit)}${wrappedArg}`;\n\t\t})\n\t\t.with({ type: \"annotation\" }, ({ term, ann }) => {\n\t\t\treturn `(${display(term)} : ${display(ann)})`;\n\t\t})\n\n\t\t.with({ type: \"row\" }, ({ row }) => {\n\t\t\treturn R.display({\n\t\t\t\tterm: display,\n\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t})(row);\n\t\t})\n\t\t.with({ type: \"tuple\" }, ({ row }) => {\n\t\t\tconst r = R.display({\n\t\t\t\tterm: display,\n\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t})(row);\n\t\t\treturn `tuple ${r}`;\n\t\t})\n\t\t.with({ type: \"struct\" }, ({ row }) => {\n\t\t\tconst r = R.display({\n\t\t\t\tterm: display,\n\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t})(row);\n\t\t\treturn `struct ${r}`;\n\t\t})\n\t\t.with({ type: \"variant\" }, ({ row }) => {\n\t\t\tconst r = R.display({\n\t\t\t\tterm: display,\n\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t})(row);\n\t\t\treturn `variant ${r}`;\n\t\t})\n\t\t.with({ type: \"tagged\" }, ({ tag, term }) => {\n\t\t\treturn `(tagged ${tag}: ${display(term)})`;\n\t\t})\n\t\t.with({ type: \"list\" }, ({ elements }) => {\n\t\t\treturn `[ ${elements.map(display).join(\", \")} ]`;\n\t\t})\n\t\t.with({ type: \"projection\" }, ({ term, label }) => {\n\t\t\treturn `(${display(term)}).${label}`;\n\t\t})\n\t\t.with({ type: \"injection\" }, ({ label, value, term }) => {\n\t\t\treturn `{ ${display(term)} | ${label} = ${display(value)} }`;\n\t\t})\n\t\t.with({ type: \"match\" }, ({ scrutinee, alternatives }) => {\n\t\t\tconst scut = display(scrutinee);\n\t\t\tconst alts = alternatives.map(Alt.display).join(\"\\n\");\n\t\t\treturn `match ${scut}\\n${alts}`;\n\t\t})\n\t\t.with({ type: \"block\" }, ({ statements, return: ret }) => {\n\t\t\tconst stmts = statements.map(Stmt.display).join(\";\\n\");\n\t\t\treturn `{\\n${stmts}\\nreturn ${ret ? display(ret) : \"\"};\\n}`;\n\t\t})\n\t\t.with({ type: \"modal\" }, ({ term, modalities }) => {\n\t\t\tconst tm = display(term);\n\t\t\tconst q = modalities.quantity ? `${Q.display(modalities.quantity)} ` : \"\";\n\t\t\tconst l = modalities.liquid ? ` [| ${display(modalities.liquid)} |]` : \"\";\n\t\t\treturn `${q}${tm}${l}`;\n\t\t})\n\n\t\t.otherwise(tm => `Display Term ${tm.type}: Not implemented`);\n};\n\nconst arr = (icit: string) => (icit === \"Implicit\" ? \"=>\" : \"->\");\n\nexport const Alt = {\n\tdisplay: (alt: Src.Alternative): string => `| ${Pat.display(alt.pattern)} -> ${display(alt.term)}`,\n};\n\nexport const Pat = {\n\tdisplay: (pat: Src.Pattern): string => {\n\t\treturn (\n\t\t\tmatch(pat)\n\t\t\t\t.with({ type: \"lit\" }, ({ value }) => Lit.display(value))\n\t\t\t\t.with({ type: \"var\" }, ({ value }) => value.value)\n\t\t\t\t// .with({ type: \"Wildcard\" }, () => \"_\")\n\t\t\t\t.with({ type: \"row\" }, ({ row }) =>\n\t\t\t\t\tR.display({\n\t\t\t\t\t\tterm: Pat.display,\n\t\t\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t\t\t})(row),\n\t\t\t\t)\n\t\t\t\t.with({ type: \"struct\" }, ({ row }) => {\n\t\t\t\t\tconst r = R.display({\n\t\t\t\t\t\tterm: Pat.display,\n\t\t\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t\t\t})(row);\n\t\t\t\t\treturn `Struct ${r}`;\n\t\t\t\t})\n\t\t\t\t.with({ type: \"variant\" }, ({ row }) => {\n\t\t\t\t\tconst r = R.display({\n\t\t\t\t\t\tterm: Pat.display,\n\t\t\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t\t\t})(row);\n\t\t\t\t\treturn `Variant ${r}`;\n\t\t\t\t})\n\t\t\t\t.with({ type: \"tuple\" }, ({ row }) => {\n\t\t\t\t\tconst r = R.display({\n\t\t\t\t\t\tterm: Pat.display,\n\t\t\t\t\t\tvar: (v: Src.Variable) => v.value,\n\t\t\t\t\t})(row);\n\t\t\t\t\treturn `Tuple ${r}`;\n\t\t\t\t})\n\t\t\t\t.with({ type: \"list\" }, ({ elements, rest }) => {\n\t\t\t\t\tconst els = elements.map(Pat.display).join(\", \");\n\t\t\t\t\tconst r = rest ? ` | ${rest.value}` : \"\";\n\t\t\t\t\treturn `[ ${els}${r} ]`;\n\t\t\t\t})\n\t\t\t\t.otherwise(() => \"Pattern Display: Not implemented\")\n\t\t);\n\t},\n};\n\nexport const Stmt = {\n\tdisplay: (stmt: Src.Statement): string => {\n\t\treturn match(stmt)\n\t\t\t.with({ type: \"expression\" }, ({ value }) => display(value))\n\t\t\t.with({ type: \"let\" }, ({ variable, annotation, value, multiplicity }) => {\n\t\t\t\tconst ann = annotation ? `: ${display(annotation)}` : \"\";\n\t\t\t\tconst mul = multiplicity ? `${multiplicity} ` : \"\";\n\t\t\t\treturn `let ${mul}${variable}${ann} = ${display(value)}`;\n\t\t\t})\n\t\t\t.otherwise(() => \"Statement Display: Not implemented\");\n\t},\n};\n"],"mappings":"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","names":["term"]}