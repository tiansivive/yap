{"version":3,"sources":["../../src/Codegen/modules.ts"],"sourcesContent":["import { match } from \"ts-pattern\";\nimport { Interface } from \"../modules/loading\";\nimport { entries } from \"@yap/utils\";\n\nimport * as E from \"fp-ts/lib/Either\";\n\nimport * as CG from \"./terms\";\n\nexport const codegen = (module: Interface, filepath: string) => {\n\tconst imports = entries(module.imports).reduce((code, [filepath, [errs, values]]) => {\n\t\tconst info = errs.map(([name, err]) => `\\n// Error importing ${name}: ${err.type}`);\n\n\t\tconst vars = values.map(([name]) => name).join(\", \");\n\t\tconst stmt = `\\nconst { ${vars} } = require(\"./${filepath}.js\");`;\n\n\t\treturn code + stmt + info;\n\t}, \"\");\n\n\tconst foreign = module.foreign.reduce((code, [name, result]) => {\n\t\tconst stmt = E.isLeft(result)\n\t\t\t? `\\n// Error importing ${name}: ${result.left}`\n\t\t\t: `\\nconst { ${name} } = require(\"./${filepath.replace(/\\.yap$/, \".ffi.js\")}\");`;\n\t\treturn code + stmt;\n\t}, \"\");\n\n\tconst letdecs = module.letdecs.reduce((code, [name, result]) => {\n\t\tconst stmt = E.isLeft(result) ? `\\n// Error importing ${name}: ${result.left}` : `\\nlet ${name} = ${CG.codegen([name], result.right[0])};`;\n\t\treturn code + stmt;\n\t}, \"\");\n\n\tconst exports = `\\nmodule.exports = { ${module.exports.join(\", \")} };`;\n\n\treturn imports + foreign + letdecs + exports;\n};\n"],"mappings":";AAEA,SAAS,eAAe;AAExB,YAAY,OAAO;AAEnB,YAAY,QAAQ;AAEb,MAAM,UAAU,CAAC,QAAmB,aAAqB;AAC/D,QAAM,UAAU,QAAQ,OAAO,OAAO,EAAE,OAAO,CAAC,MAAM,CAACA,WAAU,CAAC,MAAM,MAAM,CAAC,MAAM;AACpF,UAAM,OAAO,KAAK,IAAI,CAAC,CAAC,MAAM,GAAG,MAAM;AAAA,qBAAwB,IAAI,KAAK,IAAI,IAAI,EAAE;AAElF,UAAM,OAAO,OAAO,IAAI,CAAC,CAAC,IAAI,MAAM,IAAI,EAAE,KAAK,IAAI;AACnD,UAAM,OAAO;AAAA,UAAa,IAAI,mBAAmBA,SAAQ;AAEzD,WAAO,OAAO,OAAO;AAAA,EACtB,GAAG,EAAE;AAEL,QAAM,UAAU,OAAO,QAAQ,OAAO,CAAC,MAAM,CAAC,MAAM,MAAM,MAAM;AAC/D,UAAM,OAAO,EAAE,OAAO,MAAM,IACzB;AAAA,qBAAwB,IAAI,KAAK,OAAO,IAAI,KAC5C;AAAA,UAAa,IAAI,mBAAmB,SAAS,QAAQ,UAAU,SAAS,CAAC;AAC5E,WAAO,OAAO;AAAA,EACf,GAAG,EAAE;AAEL,QAAM,UAAU,OAAO,QAAQ,OAAO,CAAC,MAAM,CAAC,MAAM,MAAM,MAAM;AAC/D,UAAM,OAAO,EAAE,OAAO,MAAM,IAAI;AAAA,qBAAwB,IAAI,KAAK,OAAO,IAAI,KAAK;AAAA,MAAS,IAAI,MAAM,GAAG,QAAQ,CAAC,IAAI,GAAG,OAAO,MAAM,CAAC,CAAC,CAAC;AACvI,WAAO,OAAO;AAAA,EACf,GAAG,EAAE;AAEL,QAAM,UAAU;AAAA,qBAAwB,OAAO,QAAQ,KAAK,IAAI,CAAC;AAEjE,SAAO,UAAU,UAAU,UAAU;AACtC;","names":["filepath"]}